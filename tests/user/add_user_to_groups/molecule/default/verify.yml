---
# Purpose: assert that the instance really ended up in the expected state.
# Molecule calls this playbook with `molecule verify`.
- name: Verify
  hosts: all
  tasks:
    - name: Get user info
      ansible.builtin.command: id testuser
      register: user_info
      changed_when: false

    - name: Assert user is in group1
      ansible.builtin.assert:
        that:
          - "'group1' in user_info.stdout"
          - "'group2' in user_info.stdout"
        msg: "testuser is not in group1 or group2"
